services:
  plugin.manager.jsonrpc_method:
    parent: default_plugin_manager
    class: Drupal\jsonrpc\Plugin\JsonRpcMethodManager
    public: false

  jsonrpc.handler:
    class: Drupal\jsonrpc\HandlerInterface'
    alias: plugin.manager.jsonrpc_method
    public: true

  serializer.normalizer.jsonrpc_request:
    class: Drupal\jsonrpc\Normalizer\RequestNormalizer
    arguments: ['@jsonrpc.handler', '@typed_data_manager', '@service_container']
    tags:
      - { name: normalizer }

  serializer.normalizer.jsonrpc_response:
    class: Drupal\jsonrpc\Normalizer\ResponseNormalizer
    tags:
      - { name: normalizer }

  serializer.normalizer.jsonrpc_annotation:
    class: Drupal\jsonrpc\Normalizer\AnnotationNormalizer
    tags:
      - { name: normalizer }

  jsonrpc.http_middleware.format_setter:
    class: Drupal\jsonrpc\StackMiddleware\FormatSetter
    arguments: ['@kernel']
    tags:
      # Set priority to 201 so it happens right before the page cache
      # middleware (priority 200)has the opportunity to respond.
      - { name: http_middleware, priority: 201 }